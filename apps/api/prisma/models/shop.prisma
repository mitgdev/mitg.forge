enum ShopServiceType {
  COINS
}

model miforge_shop_service {
  id          Int             @id @default(autoincrement()) @db.UnsignedInt
  type        ShopServiceType
  slug        String          @unique @db.VarChar(100)
  title       String          @db.VarChar(255)
  description String?         @db.Text

  transactions miforge_shop_transactions[]

  unit_price Int     @default(0) @db.UnsignedInt
  quantity   Int     @default(1) @db.UnsignedInt
  is_active  Boolean @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
}

enum ShopTransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELED
  REFUNDED
}

enum ShopProviderMethod {
  PIX
}

enum ShopProvider {
  MERCADO_PAGO
}

model miforge_shop_providers {
  id Int @id @default(autoincrement()) @db.UnsignedInt

  name        String  @db.VarChar(100)
  description String? @db.Text
  isActive    Boolean @default(true) @map("is_active")

  method   ShopProviderMethod
  provider ShopProvider

  transactions miforge_shop_transactions[]

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@unique([method, provider], name: "uniq_method_provider")
}

model miforge_shop_transactions {
  id Int @id @default(autoincrement()) @db.UnsignedInt

  status              ShopTransactionStatus @default(PENDING)
  methodTransactionId String?               @map("method_transaction_id") @db.VarChar(255)

  units Int @default(1) @db.UnsignedInt
  total Int @default(0) @db.UnsignedInt

  providerId Int                    @map("provider_id") @db.UnsignedInt
  provider   miforge_shop_providers @relation(fields: [providerId], references: [id], onDelete: Cascade)

  serviceId Int                  @map("service_id") @db.UnsignedInt
  service   miforge_shop_service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  accountId Int      @map("account_id") @db.UnsignedInt
  account   accounts @relation(fields: [accountId], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@index([serviceId, accountId], name: "idx_service_account_provider")
  @@index([methodTransactionId], name: "idx_method_transaction_id")
  @@index([status], name: "idx_status")
}
